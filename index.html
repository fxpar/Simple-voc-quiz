<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>title</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="robots" content="index,follow" />
	<link rel="stylesheet" type="text/css" href="styles.css" />
	<style>


	#qbar {
        /* style de la barre du haut avec les traits pour chaque r√©ponse */
        text-align:left;}
	.w {
        /* couleur des mauvaises r√©ponses Wrong */
        color:lightgrey;}
	.c {
        /* couleur des bonnes r√©pones Correct */
        color:grey;}

	
		#qcue{
            /* style de la question */
	min-height:40px;
	}
	summary {
        /* style du menu d√©pliable "vocabulaire" */
		margin-left:25%;
	}

	#qlabel, summary{
	color: grey;
	}
	.card {
        /* style de la partie quiz */
	text-align:center;
	box-shadow: 0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);
    /* margin auto permet l'alignement au milieu */
	margin:auto;
	width:50%;
	 min-width: 200px;
	 height: 200px;
	 
	}
	
	@media only screen and (max-width: 600px) {
  .card {
	margin:auto;
	text-align:center;
	width:90%;
	 height: 200px;
	}
	
	summary {
		margin-left:5%;
	}
}
	
	</style>

<script>
    /**
     * @class Quiz
     * @property {function} show - affiche les √©l√©ments sur la page
     * @property {function} load - charge les questions du vocabulaire
     * @property {function} play - joue la question suivante, ou la fin, ou le red√©marrage
     **/
function Quiz(){
   
    console.log("initialize quiz");
    this.sep = "\t"; // separateur par d√©faut pour d√©couper le vocabulaire
    this.defaultSource = document.getElementById("voc1");// d√©finit l'√©l√©ment qui contient la source par d√©faut o√π trouver le vocabulaire
    this.headers = []; //ent√™te du vocabulaire = les titres
    this.jsonObj = []; // array d'objets contenant chaque √©l√©ments de vocabulaire
    this.qnum =0; // initialisation du num√©ro de la question √† 0
	this.state = "notReady";
    
/**
 * Affiche les diff√©rents √©l√©ments
 * Tous les param√®tres sont du texte
 * G√©n√©ralement appel√© par {@link this.showNum()}
 * @param {string} qcue - la question ex: "strawberry"
 * @param {string} qlabel - le nom de la colonne pour la r√©ponse attendue ex: "Fran√ßais"
 * @param {string} qcorr - la bonne r√©ponse doit √™tre vide quand on est en phase de pose de question
 * @param {string} uanswer - la r√©ponse de l'utilisateur = value d'un textarea
 **/
    this.show = function(qcue="&nbsp;", qlabel="&nbsp;", qcorr="&nbsp;", uanswer="", qnum="&nbsp;", qhint="&nbsp;", buttontxt="‚ñª" ){
        document.getElementById("qcue").innerHTML = qcue.trim();
        document.getElementById("qlabel").innerHTML = qlabel.trim();
        document.getElementById("qcorr").innerHTML = qcorr.trim();
        document.getElementById("uanswer").value = uanswer.trim();
        document.getElementById("qnum").innerHTML = qnum.trim();
        //document.getElementById("qhint").innerHTML = qhint.trim(); // un indice: inutilis√© pour l'instant, aucun √©l√©ment id="qhint"
    }

/**
 * Charge le vocabulaire depuis la source par d√©faut
 * utilise le s√©parateur \t tab par d√©faut
 * ajouter le titre des colonne √† l'array headers (premi√®re ligne)
 * @return: l'array of objects jsonObj contenant les lignes de questions
 **/
    this.load = function(){
       
		console.log("this.load");
        // remet √† 0 le jsonObj pour que √ßa n'ajoute pas les nouvelles questions aux pr√©c√©dentes
		this.jsonObj = [];
        // charger la source par d√©faut textarea id=voc1
		rawVoc = this.defaultSource.value.trim();
		
		arr = rawVoc.split('\n'); // s√©pare chaque ligne et le met dans arr

		/*
		 Ins√®re les titres des colonnes dans quiz.headers
		*/
		this.headers = arr[0].split(this.sep);

        /*
         charge le vocabulaire dans jsonObj
        */
		for(var i = 1; i < arr.length; i++) {
		  var data = arr[i].split(this.sep);
		  var obj = {};
		  for(var j = 0; j < data.length; j++) {
			 obj[this.headers[j].trim()] = data[j].trim();
		  }
		  this.jsonObj.push(obj);
		}
		//this.qCol = this.headers[0];
		//this.qlabel = this.headers[1];
		console.log(this.jsonObj);
		this.state = "ready";
	}
    /**
     * Lance l'affichage d'une question particuli√®re, avec sa correction ou non
     * @param {integer} num - le num√©ro de la question commen√ßant √† 0
     * @param {boolean} corr - d√©faut false; true pour afficher la correction de la question
     * */
    this.showNum = function(num, corr = false){
        if (corr == false){
            var correction = "&nbsp;";
        }else{
           var correction = this.jsonObj[this.qnum][this.headers[1]];
        }
        this.show(this.jsonObj[this.qnum][this.headers[0]], this.headers[1], correction);
    }
	this.showFinish = function(){
		this.show( "bravo!!!");

	}
	
	this.checkAnswer = function(){
		if(this.jsonObj[this.qnum][this.headers[1]].toLowerCase() == document.getElementById("uanswer").value.toLowerCase()){
			return true;
		}else{
			return false;
		}
	}


this.play = function(){
	if (this.state == "notReady"){
		this.load();
		//this.show( "ajoutez du vocabulaire");
	}else if (this.qnum == this.jsonObj.length ){
		this.showFinish();
		this.state == "ready";
		this.qnum = 0;
	}else if (this.state == "ready"){
		this.showNum(this.qnum);
		this.state = "checkAnswer";
	}else if(this.state == "checkAnswer"){
		if(this.checkAnswer() == true){
			this.qnum++;
			this.state = "ready";
			this.play();
		}else{
			this.showNum(this.qnum, true);
			this.qnum++;
			this.state = "ready";
		}
	};
    console.log("play:"+this.qnum);
    //this.showNum(this.qnum);
	
    //this.show(this.jsonObj[this.qnum][this.qlabel], this.headers[1]);
    
}

/**
 * Execute les m√©thodes de l'objet
 **/    
this.load(); // charger le quiz et le vocabulaire
this.play(); // lance la premi√®re question
//this.show(this.jsonObj[this.qnum][this.qlabel], this.headers[1]); // juste pour tester
}

	
</script>
	
	
	
</head>

<body  onload="quiz = new Quiz();">
<div class="card">
	<div id="qbar">&nbsp;</div>
	<div id="qnum">&nbsp;</div>
	<div id="qcue">&nbsp;</div>
	<div id="qcorr">&nbsp;</div>
	<form action="#" onsubmit="return false">
		<label id="qlabel" for="uanswer">vocabulaire</label>
		<input type="text" id="uanswer" autofocus autocomplete="off"></input>
		<button onclick="quiz.play();">&nbsp; ‚ñª &nbsp;</button>
	</form>
</div>
<div>&nbsp;</div>
<div>&nbsp;</div>

<details>
<summary>üí¨voc</summary>

<textarea  type="text" rows="5" style="width:100%" id="voc1" >
Chinois	Pin1yin1	Pinyin	English	Fran√ßais
Êàë	wo3	w«í	I	je
‰ªñ	ta1	tƒÅ	he	il
Â•π	ta1	tƒÅ	she	elle
‰Ω†	ni3	n«ê	you	tu
Ê°É	tao2	t√°o	peach	p√®che
Èªé	li2	l√≠	pear	poire
</textarea>
<button onclick="init();">update</button>

</details>
</body>
</html>
